function makeDraggable(t){t.addEventListener("mousedown",(()=>{const e=t.offsetWidth;t.style.setProperty("--original-width",`${e}px`)}));let e=0,n=0,o=0,s=0;function i(i){i.preventDefault(),e=o-i.clientX,n=s-i.clientY,o=i.clientX,s=i.clientY,t.style.top=t.offsetTop-n+"px",t.style.left=t.offsetLeft-e+"px"}function d(){document.removeEventListener("mouseup",d),document.removeEventListener("mousemove",i),chrome.storage.sync.set({triviaX:t.offsetLeft,triviaY:t.offsetTop})}t.addEventListener("mousedown",(function(t){t.preventDefault(),o=t.clientX,s=t.clientY,document.addEventListener("mouseup",d),document.addEventListener("mousemove",i)}))}chrome.runtime.onInstalled.addListener((()=>{console.log("Extension installed!")})),document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("bgColorPicker"),e=document.getElementById("colorPickerBtn");document.getElementById("currentColor");chrome.storage.local.get(["backgroundColor"],(function(e){e.backgroundColor&&(document.body.style.backgroundColor=e.backgroundColor,t.value=e.backgroundColor)})),e.addEventListener("click",(()=>{t.click()})),t.addEventListener("change",(t=>{const e=t.target.value;document.body.style.backgroundColor=e,chrome.storage.local.set({backgroundColor:e})}))})),document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll(".draggable-component").forEach(makeDraggable)})),document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("feedback-icon"),e=document.getElementById("feedback-dialog"),n=document.getElementById("feedback-send-button"),o=document.getElementById("feedback-input");t.addEventListener("click",(()=>{e.classList.remove("hidden")})),e.addEventListener("click",(t=>{t.target===e&&e.classList.add("hidden")})),n.addEventListener("click",(async()=>{const t=o.value.trim();if(t)try{fetch("https://ntbvju14ce.execute-api.us-east-1.amazonaws.com/dev/submitFeedback",{method:"POST",body:JSON.stringify({feedback:t})}).then((t=>t.json())).then((t=>{alert("Thanks for your feedback!"),o.value="",e.classList.add("hidden")})).catch((t=>{console.error("Error submitting feedback:",t),alert("Something went wrong. Please try again later.")}))}catch(t){console.error("Error submitting feedback:",t),alert("Something went wrong. Please try again later.")}}))})),document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("theme-label"),e=document.getElementById("theme-select");function n(e){/^[AEIOUaeiou]/.test(e)?t.textContent="i'm an":t.textContent="i'm a"}chrome.storage.sync.get("preferredTheme",(t=>{t.preferredTheme&&(e.value=t.preferredTheme,n(t.preferredTheme))})),e.addEventListener("change",(()=>{const t=e.value;chrome.storage.sync.set({preferredTheme:t},(()=>{console.log("Theme preference saved:",t)})),n(t)}))}));const quoteWidget={id:"quote",name:"Quotes",render:function(){this.loadAndDisplayQuote(),chrome.storage.onChanged.addListener(((t,e)=>{"sync"===e&&t.preferredTheme&&location.reload()}))},hide:function(){const t=document.getElementById("quote-text");t&&(t.textContent="",t.classList.remove("typing"));const e=document.getElementById("quote-container");e&&(e.style.display="none")},loadAndDisplayQuote:function(){const t=document.getElementById("quote-text");t.textContent="",chrome.storage.sync.get("preferredTheme",(e=>{let n=e.preferredTheme||"default",o=`${n}Index`;chrome.storage.sync.get(o,(e=>{let s=e[o]||0;fetch(`https://ntbvju14ce.execute-api.us-east-1.amazonaws.com/dev/quote?category=${n}&index=${s}`).then((t=>t.json())).then((e=>{const n=e.text.text,i=document.getElementById("quote-container");i.style.display="block",t.textContent=n;const d=e.text?.theme;let c=["happy","melancholic","inspirational","thoughtful","motivational"];const r=c[Math.floor(Math.random()*c.length)];t.textContent="",i.classList.add(d??r),function(t,e){e.classList.add("typing"),e.innerHTML="";let n=0,o=!0;function s(){o&&(n<t.length?(e.innerHTML+=t.charAt(n),n++,setTimeout(s,100)):e.classList.remove("typing"))}s(),quoteWidget.hide=function(){o=!1,e&&(e.textContent="",e.innerHTML="",e.classList.remove("typing"));const t=document.getElementById("quote-container");t&&(t.style.display="none")}}(n,t);let a=(s+1)%e.totalQuotes;chrome.storage.sync.set({[o]:a})})).catch((t=>console.error("Error fetching quote:",t)))}))}))}};window.quoteWidget=quoteWidget,document.addEventListener("DOMContentLoaded",(function(){document.getElementById("sub").addEventListener("submit",(function(t){t.preventDefault();let e=document.getElementById("search-input").value;e&&chrome.search.query({text:e,disposition:"CURRENT_TAB"})}))})),document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("settingsBtn"),e=document.getElementById("widget-settings"),n=document.getElementById("widget-list"),o=document.getElementById("iamSelector"),s=document.getElementById("addShortcutBtn"),i=document.getElementById("info-button"),d=document.getElementById("info-popup");function c(){chrome.storage.sync.get("enabledWidgets",(t=>{const e=t.enabledWidgets||[];e.includes("quote")?o.style.display="block":o.style.display="none",e.includes("shortcuts")?s.style.display="block":s.style.display="none"}))}i.addEventListener("click",(t=>{t.stopPropagation(),d.classList.contains("hidden")&&d.classList.remove("hidden"),d.classList.toggle("show")})),document.addEventListener("click",(t=>{i.contains(t.target)||d.contains(t.target)||(d.classList.remove("show"),d.classList.contains("show")||d.classList.add("hidden"))})),t.addEventListener("click",(t=>{t.stopPropagation(),e.classList.toggle("show")})),document.addEventListener("click",(n=>{e.contains(n.target)||t.contains(n.target)||e.classList.remove("show")})),chrome.storage.sync.get(["enabledWidgets","firstTimeInstall"],(t=>{let e=t.enabledWidgets;void 0===t.firstTimeInstall&&(e=widgets.map((t=>t.id)),chrome.storage.sync.set({enabledWidgets:e,firstTimeInstall:!1})),widgets.forEach((t=>{const o=document.createElement("div");o.className="widget-item";const s=document.createElement("label"),i=document.createElement("input");i.type="checkbox",i.checked=e.includes(t.id);const d=document.createTextNode(t.name);i.addEventListener("change",(()=>{chrome.storage.sync.get("enabledWidgets",(e=>{let n=e.enabledWidgets||[];i.checked?n.includes(t.id)||n.push(t.id):n=n.filter((e=>e!==t.id)),chrome.storage.sync.set({enabledWidgets:n},(()=>{chrome.storage.sync.get("enabledWidgets",(t=>{const e=t.enabledWidgets||[];c(),widgets.forEach((t=>{const n=document.getElementById(`${t.id}-container`);if(e.includes(t.id))n&&"none"!==n.style.display||t.render();else try{t.hide()}catch(e){console.log(`Failed to hide widget ${t.id}:`,e)}}))})),c()}))}))})),s.appendChild(i),s.appendChild(d),o.appendChild(s),n.appendChild(o)})),c()})),document.getElementById("widget-list").addEventListener("change",c)}));const shortcutsWidget={id:"shortcuts",name:"Shortcuts",MAX_SHORTCUTS:10,shortcuts:[],shortcutContainer:null,addShortcutBtn:null,shortcutModal:null,modalTitle:null,shortcutTitleInput:null,shortcutUrlInput:null,saveShortcutBtn:null,cancelShortcutBtn:null,widgets:null,editIndex:null,hide:function(){this.shortcutContainer=document.getElementById("shortcutContainer"),this.shortcutContainer&&(this.shortcutContainer.style.display="none")},updateAddButtonState:function(){this.addShortcutBtn&&(this.addShortcutBtn.disabled=this.shortcuts.length>=this.MAX_SHORTCUTS,this.addShortcutBtn.title=this.shortcuts.length>=this.MAX_SHORTCUTS?"Maximum shortcuts limit reached (10)":"Add new shortcut")},render:function(){this.shortcutContainer=document.getElementById("shortcutContainer"),this.shortcutContainer.style.display="flex",this.addShortcutBtn=document.getElementById("addShortcutBtn"),this.shortcutModal=document.getElementById("shortcutModal"),this.modalTitle=document.getElementById("modalTitle"),this.shortcutTitleInput=document.getElementById("shortcutTitle"),this.shortcutUrlInput=document.getElementById("shortcutUrl"),this.saveShortcutBtn=document.getElementById("saveShortcutBtn"),this.cancelShortcutBtn=document.getElementById("cancelShortcutBtn"),this.initEventListeners(),this.loadShortcutsAndRender()},initEventListeners:function(){this.addShortcutBtn.removeEventListener("click",this.handleAddShortcut),this.handleAddShortcut=()=>{this.shortcuts.length<this.MAX_SHORTCUTS&&this.openAddModal()},this.addShortcutBtn.addEventListener("click",this.handleAddShortcut),this.saveShortcutBtn.addEventListener("click",(()=>{this.saveShortcut()})),this.cancelShortcutBtn.addEventListener("click",(()=>{this.closeModal()})),this.shortcutModal.addEventListener("click",(t=>{t.target===this.shortcutModal&&this.closeModal()}))},loadShortcutsAndRender:function(){chrome.storage.sync.get(["myShortcuts"],(t=>{this.shortcuts=t.myShortcuts||[],this.renderShortcuts(),this.updateAddButtonState()}))},renderShortcuts:function(){this.shortcutContainer.innerHTML="",this.shortcuts.forEach(((t,e)=>{const n=document.createElement("div");let o;n.className="shortcut-tile";try{o=new URL(t.url).hostname}catch{o=t.url}const s=document.createElement("img");s.src=`https://www.google.com/s2/favicons?domain=${o}&sz=128`,s.onerror=()=>{s.src=`https://www.google.com/s2/favicons?domain=${o}&sz=64`};const i=document.createElement("span");i.textContent=t.title||o;const d=document.createElement("button");d.className="edit-btn",d.innerHTML="✏️",d.title="Edit shortcut",d.addEventListener("click",(t=>{t.stopPropagation(),this.openEditModal(e)}));const c=document.createElement("button");c.className="delete-btn",c.innerHTML="×",c.title="Delete shortcut",c.addEventListener("click",(t=>{t.stopPropagation(),this.deleteShortcut(e)})),n.addEventListener("click",(()=>{window.open(t.url,"_blank")})),n.appendChild(s),n.appendChild(i),n.appendChild(d),n.appendChild(c),this.shortcutContainer.appendChild(n)})),this.updateAddButtonState()},saveShortcutsToStorage:function(){const t=[...new Map(this.shortcuts.map((t=>[t.url,t]))).values()];chrome.storage.sync.set({myShortcuts:t},(()=>{this.shortcuts=t,this.renderShortcuts()}))},openAddModal:function(){this.shortcuts.length>=this.MAX_SHORTCUTS?alert(`Maximum number of shortcuts (${this.MAX_SHORTCUTS}) reached!`):(this.editIndex=null,this.modalTitle.textContent="Add Shortcut",this.shortcutTitleInput.value="",this.shortcutUrlInput.value="",this.shortcutModal.style.display="block")},openEditModal:function(t){this.editIndex=t;const e=this.shortcuts[t];this.modalTitle.textContent="Edit Shortcut",this.shortcutTitleInput.value=e.title,this.shortcutUrlInput.value=e.url,this.shortcutModal.style.display="block"},deleteShortcut:function(t){confirm("Are you sure you want to delete this shortcut?")&&(this.shortcuts.splice(t,1),this.saveShortcutsToStorage())},saveShortcut:function(){const t=this.shortcutTitleInput.value.trim();let e=this.shortcutUrlInput.value.trim();if(t&&e){/^https?:\/\//i.test(e)||(e="https://"+e);try{if(new URL(e),null!==this.editIndex)this.shortcuts[this.editIndex].title=t,this.shortcuts[this.editIndex].url=e;else{if(this.shortcuts.length>=this.MAX_SHORTCUTS)return void alert(`Maximum number of shortcuts (${this.MAX_SHORTCUTS}) reached!`);this.shortcuts.push({title:t,url:e})}this.saveShortcutsToStorage(),this.closeModal()}catch(t){alert("Please enter a valid URL")}}else alert("Please fill in both fields")},closeModal:function(){this.shortcutModal.style.display="none"}};window.shortcutsWidget=shortcutsWidget;const triviaWidget={id:"trivia",name:"Trivia",render:function(){this.loadAndDisplayTriviaQuestion()},hide:function(){const t=document.getElementById("trivia-container");t&&(t.style.display="none")},loadAndDisplayTriviaQuestion:function(){chrome.storage.sync.get(["triviaScore","triviaX","triviaY"],(t=>{let e=t.triviaScore||0;fetch(`https://ntbvju14ce.execute-api.us-east-1.amazonaws.com/dev/trivia?score=${e}`).then((t=>t.json())).then((n=>{this.displayTriviaQuestion(n,t,e)})).catch((t=>console.error("Error fetching trivia:",t)))}))},displayTriviaQuestion:function(t,e,n){const o=document.getElementById("trivia-container"),s=document.getElementById("trivia-question"),i=document.getElementById("trivia-options-container"),d=document.getElementById("trivia-score"),c=document.getElementById("trivia-difficulty");let r=e.triviaX,a=e.triviaY;o.style.left=`${r}px`,o.style.top=`${a}px`,s.textContent=t.question,i.innerHTML="",d.textContent=`Score: ${n}`,c.textContent=`Current Difficulty: ${t.difficulty}`,o.className=`${t.difficulty.toLowerCase()}`,o.style.display="block",Object.entries(t.options).forEach((([e,o])=>{const s=document.createElement("button");s.textContent=`${e}. ${o}`,s.classList.add("trivia-button"),s.addEventListener("click",(()=>{this.handleAnswer(e,t.answer,n,s)})),i.appendChild(s)}))},handleAnswer:function(t,e,n,o){const s=t===e;o.classList.add(s?"correct":"wrong"),n=s?n+1:n-1;document.querySelectorAll(".trivia-button").forEach((t=>t.disabled=!0)),setTimeout((()=>{chrome.storage.sync.set({triviaScore:n},(()=>{this.loadAndDisplayTriviaQuestion()}))}),250)}};window.triviaWidget=triviaWidget;const widgets=[window.quoteWidget,window.triviaWidget,window.shortcutsWidget];function loadWidgets(){chrome.storage.sync.get(["enabledWidgets","firstTimeInstall"],(t=>{let e=t.enabledWidgets;void 0===t.firstTimeInstall&&(e=widgets.map((t=>t.id)),chrome.storage.sync.set({enabledWidgets:e,firstTimeInstall:!1})),widgets.forEach((t=>{e.includes(t.id)?t.render():t.hide()}))}))}document.addEventListener("DOMContentLoaded",loadWidgets);